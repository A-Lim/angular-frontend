<ng-container *transloco="let trans">
  <form *ngIf="formGroup$ | async as formGroup" nz-form [formGroup]="formGroup">
    <div class="divide-y sm:divide-y-0">
      <ng-container formArrayName="packages">
        <ng-container
          *ngFor="let row of (formGroup | toFormArray : 'packages').controls; let i = index"
          [formGroupName]="i"
        >
          <div
            class="grid grid-cols-none md:grid-cols-2 lg:grid-cols-4 gap-x-4"
            [ngClass]="{
              'pt-4 sm:pt-0': i !== 0
            }"
          >
            <nz-form-item class="col-span-2 md:col-span-1">
              <nz-form-control [nzErrorTip]="nameErr">
                <nz-form-label
                  nzNoColon="true"
                  nzRequired
                  [ngClass]="{
                    block: i === 0,
                    'block sm:hidden': i !== 0
                  }"
                  >{{ trans('name') }}</nz-form-label
                >
                <input type="text" nz-input formControlName="name" [placeholder]="trans('name')" />
                <ng-template #nameErr let-control>
                  <app-ui-form-control-errors
                    [name]="trans('name')"
                    [control]="(row | toFormGroup).controls['name']"
                  ></app-ui-form-control-errors>
                </ng-template>
              </nz-form-control>
            </nz-form-item>

            <nz-form-item>
              <nz-form-control [nzErrorTip]="defaultCountErr">
                <nz-form-label
                  nzNoColon="true"
                  nzRequired
                  [ngClass]="{
                    block: i === 0,
                    'block sm:hidden': i !== 0
                  }"
                  >{{ trans('default-count') }}</nz-form-label
                >
                <input
                  type="number"
                  nz-input
                  formControlName="default_count"
                  [placeholder]="trans('default-count')"
                />
                <ng-template #defaultCountErr let-control>
                  <app-ui-form-control-errors
                    [name]="trans('default-count')"
                    [control]="(row | toFormGroup).controls['default_count']"
                  ></app-ui-form-control-errors>
                </ng-template>
              </nz-form-control>
            </nz-form-item>

            <nz-form-item>
              <nz-form-control [nzErrorTip]="defaultPriceErr">
                <nz-form-label
                  nzNoColon="true"
                  nzRequired
                  [ngClass]="{
                    block: i === 0,
                    'block sm:hidden': i !== 0
                  }"
                  >{{ trans('default-price') }}</nz-form-label
                >
                <input
                  type="number"
                  nz-input
                  formControlName="default_price"
                  [placeholder]="trans('default-price')"
                />
                <ng-template #defaultPriceErr let-control>
                  <app-ui-form-control-errors
                    [name]="trans('default-price')"
                    [control]="(row | toFormGroup).controls['default_price']"
                  ></app-ui-form-control-errors>
                </ng-template>
              </nz-form-control>
            </nz-form-item>

            <nz-form-item class="col-span-2 md:col-span-1">
              <nz-form-control>
                <nz-form-label
                  nzNoColon="true"
                  [ngClass]="{
                    block: i === 0,
                    'block sm:hidden': i !== 0
                  }"
                  >{{ trans('description') }}</nz-form-label
                >
                <div class="flex space-x-2">
                  <textarea
                    type="text"
                    nz-input
                    formControlName="description"
                    [placeholder]="trans('description')"
                    rows="2"
                  >
                  </textarea>
                  <button
                    *ngIf="i !== 0"
                    nz-button
                    nz-tooltip
                    nzDanger
                    nzType="primary"
                    nzShape="circle"
                    type="button"
                    [nzTooltipTitle]="trans('delete')"
                    (click)="deleteRow(i)"
                  >
                    <i nz-icon nzType="delete" nzTheme="outline"></i>
                  </button>
                </div>
              </nz-form-control>
            </nz-form-item>
          </div>
        </ng-container>
      </ng-container>
    </div>

    <button nz-button nzType="dashed" class="w-full" (click)="addRows()">
      <span nz-icon nzType="plus"></span>
      {{ trans('add-another') }}
    </button>

    <div *nzModalFooter class="flex justify-end">
      <button nz-button [nzType]="'primary'" [nzLoading]="loading$ | async" (click)="submit()">
        {{ trans('create') }}
      </button>
    </div>
  </form>
</ng-container>
